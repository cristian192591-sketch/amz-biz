<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Redirecting to Amazon Business…</title>
  <style>
    body { 
      font-family: system-ui, sans-serif; 
      text-align: center; 
      padding: 40px 20px; 
      margin: 0; 
      background: #f8f9fa; 
    }
    h1 { color: #131921; }
    p { max-width: 500px; margin: 20px auto; color: #444; }
    .error { color: #d11; font-weight: bold; }
  </style>
  <script>
    // Get ASIN from URL (?asin=XXXXXXXXX)
    const params = new URLSearchParams(window.location.search);
    const asin = params.get("asin")?.trim().toUpperCase();

    if (!asin || asin.length < 8) {
      document.body.innerHTML = '<h1>Error</h1><p class="error">Missing or invalid ASIN parameter.<br>Example usage: <code>?asin=B08N5WRWNW</code></p>';
      return;
    }

    const ua = navigator.userAgent || "";
    const isAndroid = /Android/i.test(ua);
    const isIOS = /iPhone|iPad|iPod/i.test(ua);

    // Target URLs
    const webUrl = `https://www.amazon.com/dp/${asin}`;
    // Modern web-scheme style deep link (works for both shopping & business in many cases)
    const appDeepLink = `com.amazon.mobile.shopping.web://www.amazon.com/dp/${asin}`;
    // Classic intent style (more reliable for regular shopping app)
    const intentDeepLink = `intent://www.amazon.com/dp/${asin}#Intent;scheme=https;package=com.amazon.mShop.android.shopping;end;`;

    function tryRedirect() {
      // 1. Android → try Business app first, then regular shopping app
      if (isAndroid) {
        // Attempt #1: Modern scheme (sometimes recognized by Business app too)
        window.location.replace(appDeepLink);

        // Attempt #2: Classic intent → regular shopping app (very reliable)
        setTimeout(() => {
          window.location.replace(intentDeepLink);
        }, 800);

        // Final fallback: web after ~2.5 seconds
        setTimeout(() => {
          window.location.replace(webUrl);
        }, 2500);

        return;
      }

      // 2. iOS or other → best effort with web scheme (often falls back to browser anyway)
      if (isIOS) {
        window.location.replace(appDeepLink);
        // iOS fallback after short delay
        setTimeout(() => window.location.replace(webUrl), 1500);
        return;
      }

      // 3. Desktop / unknown → straight to web
      window.location.replace(webUrl);
    }

    // Start redirect
    tryRedirect();

    // Show user feedback while waiting
    document.body.innerHTML = `
      <h1>Redirecting…</h1>
      <p>Opening product <strong>${asin}</strong> in Amazon Business app (if installed)<br>
      or Amazon Shopping app…<br>
      <small>(falling back to browser in a few seconds)</small></p>
    `;
  </script>
</head>
<body>
  <noscript>
    <h1>JavaScript required</h1>
    <p>Please enable JavaScript or open this link manually:<br>
      <a href="https://www.amazon.com/dp/REPLACE_WITH_ASIN">https://www.amazon.com/dp/REPLACE_WITH_ASIN</a>
    </p>
  </noscript>
</body>
</html>
